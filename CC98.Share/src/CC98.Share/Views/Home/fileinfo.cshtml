@using CC98.Identity
@using CC98.Share.Data
@using Sakura.AspNetCore
@{
    Layout = "_Layout";
    ViewBag.PageTitle = "文件详情";
}


<style type="text/css">
    .border {
        border: 1px solid #eee;
        margin: 20px;
    }
    .label {
    display: inline-block;
    padding: 3px 4px;
    margin:3px 4px;
    font-size: 12px;
    font-weight: 600;
    line-height: 1;
    color: #fff;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,0.12);
}
</style>


@{
    var totalSize = (long)ViewData["userTotalSize"];
    var filesize = (long)ViewData["filesize"];
    var filecount = (int)ViewData["filecount"];
    var sharecount = (int)ViewData["sharecount"];
    var fileSizeNow = (totalSize - filesize) / (totalSize / 200);
    var kindOfUser = 2;
}
<hr />
@*如果发出请求的人是文件的上传者*@
@if (kindOfUser == 1)
{<div class="container">
        <div class="row">
            <div class="border col-md-3">
                <br />
                <h4><strong>上传者信息</strong></h4>
                <hr />
                <h4><img class="img-circle" width="60" height="60" src="@User.GetPortraitUri()" align="middle" />&nbsp;&nbsp;@User.Identity.Name</h4>


                <hr />
                <div>
                    <h5>我的分享数:&nbsp;&nbsp;@sharecount</h5>
                    <h5>我的文件数:&nbsp;&nbsp;@filecount</h5>
                    <hr />
                    <div class="progress" style="width:200px">
                        <div class="progress-bar" role="progressbar" aria-valuenow="60"
                             aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                            <span class="sr-only">40% 完成</span>
                        </div>
                    </div>
                    <h6>已用容量 <span class="change-size">@fileSizeNow</span>/可用容量<span class="change-size"> @filesize</span></h6>
                </div>
                <br /><br />

            </div>
            <div class="file-info border col-md-8">

                <div>
                    <br />
                    <h4><strong>文件名</strong>&nbsp;&nbsp;<small><span style="right:15px">上传于：xxxxxxx</span><span style="position:absolute;right:30px">下载次数：30</span></small></h4>
                    <hr />
                    <div style="line-height:60px">
                        <button class="btn-default btn">下载文件 <span class="glyphicon glyphicon-download-alt"></span></button>
                        <button class="btn-default btn">复制链接<span class="glyphicon glyphicon-list-alt"></span></button>
                        @*如果是本人*@
                        <button class="btn-default btn">取消分享 <span class="glyphicon glyphicon-remove"></span></button>
                        <button class="btn-default btn">选择分享 <span class="glyphicon glyphicon-share"></span></button>
                        <button class="btn-default btn">删除文件 <span class="glyphicon glyphicon-trash"></span></button>
                        <button class="btn-default btn">移动路径 <span class="glyphicon glyphicon-copy"></span></button>

                    </div>
                </div>
                <hr />
                <h4><strong>文件描述</strong> <small><span class="glyphicon glyphicon-pencil"></span>编辑</small></h4>
                <p>这是个可以用来XX，也可以用来OO的文件</p>
                <br /><br />
            </div>
        </div>
    </div> }
else
{<div class="container">
        <div class="row">
            <div class="border col-md-3">
                <br />
                <h4><strong>上传者信息</strong></h4>
                <hr />
                <h4><img class="img-circle" width="60" height="60" src="@User.GetPortraitUri()" align="middle" />&nbsp;&nbsp;@User.Identity.Name</h4>
                <hr />

                <h5>TA的分享数:&nbsp;&nbsp;@sharecount</h5>
                <button class="btn btn-link">搜索TA的分享</button>
                <button class="btn btn-link">返回我的网盘</button>



                <br /><br />

            </div>
            <div class="file-info border col-md-8">

                <div>
                    <br />
                    <h4><strong>文件名</strong>&nbsp;&nbsp;<small><span style="right:15px">上传于：xxxxxxx</span><span style="position:absolute;right:30px">下载次数：30</span></small></h4>
                    <span><a href="#" class="label" style="background-color:#fbca04; color:#332900">#标签1</a><a href="#" class="label" style="background-color:#207de5; color:#fff">#标签2</a></span>
                    <hr />
                    <div style="line-height:60px">
                        <button class="btn-default btn">下载文件 <span class="glyphicon glyphicon-download-alt"></span></button>
                        <button class="btn-default btn">复制链接<span class="glyphicon glyphicon-list-alt"></span></button>

                        @*如果不是本人*@
                        <button class="btn-default btn">转存 <span class="glyphicon glyphicon-share-alt"></span></button>
                        @*<button class="btn-default btn">复制链接 <span class="glyphicon glyphicon-list-alt"></span></button>*@
                    </div>
                </div>
                <hr />
                <h4><strong>文件描述</strong> <small><span class="glyphicon glyphicon-pencil"></span>编辑</small></h4>
                <p>这是个可以用来XX，也可以用来OO的文件</p>
                <br /><br />
            </div>
        </div>
    </div> }




@section scripts{
    <script type="text/javascript" language="javascript">
        $(document).ready(function () {
            var barSize = '@fileSizeNow';
            barSize = barSize.concat('px');
            $('.progress-bar').css('width', barSize);
            @*将文件大小替换成友好的显示*@
            var filesize1 = $(".change-size");
            var unit = "B";

            filesize1.each(function (index, element) {
                var size = parseInt($(element).html());

                if (size > 1099511627776) {
                    unit = "TB";
                    size = size * 1.00 / 1099511627776;
                }
                if (size > 1073741824) {
                    size = size * 1.00 / 1073741824;
                    unit = "GB";
                }
                if (size > 1048576) {
                    size = size / 1048576;
                    unit = "MB";
                }
                if (size > 1024) {
                    size = size / 1024;
                    unit = "KB";
                }
                size = size.toFixed(2);
                var finalSize = String(size) + unit;
                $(element).text(finalSize);

            });
        });
    </script>
}
