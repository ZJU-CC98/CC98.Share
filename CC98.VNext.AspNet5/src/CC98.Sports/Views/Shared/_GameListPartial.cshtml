@using System.Collections.Generic
@model IEnumerable<Game>

@{
	var showEvent = ViewData.GetValueOfDefault("ShowEvent", true);
	var showAdmin = User.CanOrganize();
}

<table class="table table-striped table-hover">

	<thead>
	<tr>
		<th>名称</th>

		@if (showEvent)
		{
			<th>赛事</th>
		}

		<th>开始时间</th>
		<th>结束时间</th>
		<th>地点</th>
		<th>主队</th>
		<th>客队</th>
		<th>状态</th>

		@if (showAdmin)
		{
			<th>操作</th>
		}

	</tr>
	</thead>

	<tbody>

	@foreach (var item in Model.OrderBy(i => i.Round).ThenBy(i => i.Team1Id))
	{
		<tr>
			<th>
				<a asp-controller="Game" asp-action="Detail" asp-route-id="@item.Id">@item.Name</a>
			</th>

			@if (showEvent)
			{
				<td>
					<a asp-controller="Event" asp-action="Detail" asp-route-id="@item.Event.Id">@item.Event.Name</a>
				</td>
			}

			<td>
				@if (item.StartTime != null)
				{
					<span>@item.StartTime.Value.ToString("g")</span>
				}
				else
				{
					<span class="text-muted">待定</span>
				}
			</td>
			<td>
				@if (item.EndTime != null)
				{
					<span>@item.EndTime.Value.ToString("g")</span>
				}
				else
				{
					<span class="text-muted">待定</span>
				}
			</td>
			<td>
				@if (item.Location != null)
				{
					<span>@item.Location</span>
				}
				else
				{
					<span class="text-muted">待定</span>
				}
			</td>
			<td>
				@if (item.Team1 != null)
				{
					<a asp-controller="Team" asp-action="Detail" asp-route-id="@item.Team1.Id">@item.Team1.Name</a>
				}
				else
				{
					<span class="text-muted">待定</span>
				}
			</td>
			<td>
				@if (item.Team2 != null)
				{
					<a asp-controller="Team" asp-action="Detail" asp-route-id="@item.Team2.Id">@item.Team2.Name</a>
				}
				else
				{
					<span class="text-muted">待定</span>
				}
			</td>
			<td>
				<strong>
					@switch (item.State)
					{
						case GameState.NotStarted:
							<span class="text-muted">尚未开始</span>
							break;
						case GameState.Preparing:
							<span class="text-success">正在准备</span>
							break;
						case GameState.Running:
							<span class="text-primary">正在进行</span>
							break;
						case GameState.Ended:
							<span class="text-muted">比赛结束</span>
							break;
					}
				</strong>
			</td>

			@if (showAdmin)
			{
				<td>
					<div class="btn-group btn-group-xs">
						<a asp-controller="Game" asp-action="Edit" asp-route-id="@item.Id" class="btn btn-default">编辑</a>
						<button type="button" class="btn btn-danger" data-name="@item.Name" data-id-value="@item.Id" onclick="showDeleteGame(this);">删除</button>
					</div>
				</td>
			}

		</tr>
	}

	</tbody>

</table>

@if (showAdmin)
{
	@await Html.PartialAsync("_DeleteGamePartial")
}